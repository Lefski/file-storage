{% extends "base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - File Storage{% endblock %}

{% block content %}
<div class="user-info" id="userInfo" style="display: none;">
    <h3>üë§ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
    <div id="userDetails"></div>
</div>

<div class="form-group">
    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</p>
</div>

<div class="form-group">
    <button class="btn" onclick="window.location.href='/login'">üîë –í–æ–π—Ç–∏</button>
</div>

<div class="form-group">
    <button class="btn" onclick="window.location.href='/register'" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">üìù –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
</div>

<div class="links">
    <a href="/docs">API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a>
</div>

<script>
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    const token = localStorage.getItem('token');
    if (token) {
        fetch('/me', {
            headers: {
                'Authorization': 'Bearer ' + token
            }
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Not authorized');
        })
        .then(user => {
            document.getElementById('userInfo').style.display = 'block';
            document.getElementById('userDetails').innerHTML = `
                <p><strong>–ò–º—è:</strong> ${user.username}</p>
                <p><strong>Email:</strong> ${user.email}</p>
                <p><strong>–†–æ–ª—å:</strong> ${user.role}</p>
                <button onclick="logout()" style="background: #dc3545; margin-top: 10px;">–í—ã–π—Ç–∏</button>
            `;
        })
        .catch(() => {
            localStorage.removeItem('token');
        });
    }

    function logout() {
        localStorage.removeItem('token');
        window.location.href = '/';
    }
</script>
{% endblock %}